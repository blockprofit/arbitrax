<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mini Pool</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    body { margin:0; font-family:'Segoe UI',sans-serif; background:url('fondodepantallaprincipal1.jpeg') center/cover no-repeat; color:white; min-height:100vh; padding-top:60px; }
    .top-bar { position:fixed; top:0; width:100%; background:rgba(0,0,0,0.6); padding:15px 20px; display:flex; justify-content:space-between; align-items:center; z-index:100; }
    .menu-btn { font-size:24px; background:none; border:none; color:white; cursor:pointer; }
    .menu { display:none; position:absolute; top:60px; left:20px; background:rgba(0,0,0,0.9); padding:10px; border-radius:10px; width:240px; flex-direction:column; }
    .menu button { background:none; border:none; color:white; padding:10px; text-align:left; font-size:16px; cursor:pointer; }
    .menu button:hover { background:rgba(255,255,255,0.1); }
    .container { display:flex; max-width:1200px; margin:100px auto 40px; padding:0 20px; gap:30px; }
    .left, .right { background:rgba(0,0,0,0.6); border-radius:12px; padding:20px; }
    .left { flex:1; }
    .right { width:300px; height:500px; position:relative; overflow:hidden; display:flex; align-items:end; justify-content:center; }
    .coin { position:absolute; bottom:0; opacity:0.9; }
    .form-group { margin-bottom:15px; }
    .form-group select { width:100%; padding:10px; border-radius:8px; border:none; }
    .form-group button { width:100%; padding:12px; border:none; border-radius:8px; background:#00a8ff; color:white; font-weight:bold; cursor:pointer; }
    .form-group button:hover { background:#007acc; }
    table { width:100%; margin-top:20px; border-collapse:collapse; }
    th, td { padding:10px; border-bottom:1px solid rgba(255,255,255,0.2); text-align:center; }
    th { background:rgba(0,0,0,0.4); }
  </style>
</head>
<body>

  <div class="top-bar">
    <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
    <strong>Mini Pool Semanal</strong>
  </div>
  <div class="menu" id="mainMenu">
    <button onclick="window.location.href='principal.html#welcome'">Inicio</button>
    <button onclick="window.location.href='principal.html#perfil'">Perfil</button>
    <button onclick="window.location.href='inversion.html'">Nivel de inversi√≥n</button>
    <button onclick="window.location.href='deposito.html'">Dep√≥sito</button>
    <button onclick="window.location.href='retiro.html'">Retiro</button>
    <button onclick="window.location.href='referidos.html'">Programa de referidos</button>
    <button onclick="window.location.href='trivia.html'">Trivia</button>
    <button onclick="window.location.href='minipool.html'">Mini Pool</button>
    <button onclick="window.location.href='sorteo.html'">Sorteo</button>
    <button onclick="window.location.href='preguntasfrecuentes.html'">Preguntas frecuentes</button>
    <button onclick="window.location.href='terminosycondiciones.html'">T√©rminos y condiciones</button>
    <button onclick="logout()">Cerrar sesi√≥n</button>
  </div>

  <div class="container">
    <div class="left">
      <h2 style="text-align:center; margin-bottom:20px;">Particip√° en la Mini Pool</h2>
      <div class="form-group">
        <select id="nivelSelect" onchange="startAnimation()">
          <option value="">-- Seleccion√° un nivel --</option>
          <option value="basico">B√°sico ‚Äì $2.000</option>
          <option value="medio">Medio ‚Äì $5.000</option>
          <option value="avanzado">Avanzado ‚Äì $10.000</option>
        </select>
      </div>
      <div class="form-group">
        <button onclick="registrarMiniPool()">Entrar y ganar 80% en 7 d√≠as</button>
      </div>
      <h3>Tu historial reciente</h3>
      <table id="tablaMiniPool">
        <thead><tr><th>Monto</th><th>Nivel</th><th>Fecha</th><th>Estado</th></tr></thead>
        <tbody><tr><td colspan="4">Cargando...</td></tr></tbody>
      </table>
    </div>
    <div class="right" id="btcBox">
      <!-- Las monedas caer√°n aqu√≠ -->
    </div>
  </div>

  <script>
    const SUPABASE_URL = 'https://ovulezkcxwrjvyxlxsdv.supabase.co';
    const SUPABASE_ANON_KEY = 'TU_SUPABASE_ANON_KEY_COMPLETA';
    const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    let currentUserId;

    function toggleMenu() {
      const m = document.getElementById("mainMenu");
      m.style.display = m.style.display === "flex" ? "none" : "flex";
    }

    async function initMiniPool() {
      const { data: { session } } = await client.auth.getSession();
      if (!session) return window.location.href="index.html";
      currentUserId = session.user.id;
      cargarHistorial();
    }

    function startAnimation() {
      const level = document.getElementById("nivelSelect").value;
      const box = document.getElementById("btcBox");
      box.innerHTML = ""; // limpia la animaci√≥n anterior
      if (!level) return;

      let interval = level === 'basico' ? 2000 :
                     level === 'medio' ? 1000 : 500;

      let timer = setInterval(() => {
        if (box.children.length > 20) clearInterval(timer);
        const img = document.createElement("img");
        img.src = level === 'basico' ? 'btc.svg'
                 : level === 'medio' ? 'eth.svg' : 'usdt.svg';
        img.className = 'coin';
        img.style.left = Math.random() * 250 + 'px';
        box.appendChild(img);
        setTimeout(() => img.remove(), 5000);
      }, interval);
    }

    async function registrarMiniPool() {
      const sel = document.getElementById("nivelSelect");
      const nivel = sel.value;
      const monto = nivel === 'basico' ? 2000 : nivel === 'medio' ? 5000 : nivel === 'avanzado' ? 10000 : null;
      if (!monto) return alert("Seleccion√° un nivel.");

      // Por ahora no redirigimos
      await client.from("mini_pool").insert({
        usuario_id: currentUserId,
        nivel,
        monto,
        fecha_entrada: new Date().toISOString(),
        estado_pago: "pendiente"
      });
      alert("‚úÖ Entraste a la Mini Pool. Volv√© en 7 d√≠as para cobrar!");
      cargarHistorial();
    }

    async function cargarHistorial() {
      const { data } = await client.from("mini_pool")
        .select("*").eq("usuario_id", currentUserId)
        .order("fecha_entrada", { ascending: false }).limit(10);
      const tbody = document.querySelector("#tablaMiniPool tbody");
      tbody.innerHTML = '';
      if (!(data && data.length)) {
        tbody.innerHTML = '<tr><td colspan="4">No participaste a√∫n.</td></tr>';
      } else {
        data.forEach(r => {
          const f = new Date(r.fecha_entrada).toLocaleDateString('es-AR');
          tbody.innerHTML += `<tr>
            <td>${r.monto}</td>
            <td>${r.nivel}</td>
            <td>${f}</td>
            <td>${r.estado_pago === 'pagado' ? '‚úÖ' : 'üïí'}</td>
          </tr>`;
        });
      }
    }

    async function logout() {
      await client.auth.signOut();
      window.location.href = "index.html";
    }

    window.addEventListener('load', initMiniPool);
  </script>
</body>
</html>
