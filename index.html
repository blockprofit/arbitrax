<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login con Email - Supabase</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png" />

  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="Arbitrax - Plataforma de inversi√≥n cripto" />
  <meta property="og:description" content="Invert√≠ y multiplic√° tu capital con nuestras funciones: inversi√≥n, trivia, mini pool y m√°s." />
  <meta property="og:image" content="https://res.cloudinary.com/dghk6h3es/image/upload/v1750960886/arbitrax-preview_sywhbe.jpg" />
  <meta property="og:url" content="https://arbitrax-livid.vercel.app/" />
  <meta property="og:type" content="website" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Arbitrax - Plataforma de inversi√≥n cripto">
  <meta name="twitter:description" content="Sumate al ecosistema de inversi√≥n m√°s din√°mico y transparente.">
  <meta name="twitter:image" content="https://res.cloudinary.com/dghk6h3es/image/upload/v1750960886/arbitrax-preview_sywhbe.jpg">

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  
  <style>
    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Segoe UI', sans-serif;
    }

    body {
      background: url('https://github.com/blockprofit/arbitrax/blob/main/fondodepantallainicio.jpeg?raw=true') no-repeat center center fixed;
      background-size: cover;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: white;
      position: relative;
    }

    /* Logo flotante ArbitraX arriba del cuadro */
    .floating-logo {
      position: absolute;
      top: -48px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1.75rem;
      font-weight: 900;
      background: linear-gradient(135deg, #00c3ff, #00ffcc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 30px rgba(0, 195, 255, 0.5);
      animation: floatingGlow 3s ease-in-out infinite alternate;
      letter-spacing: 1.5px;
      z-index: 3;
    }

    @keyframes floatingGlow {
      from { 
        filter: brightness(1) drop-shadow(0 0 20px rgba(0, 195, 255, 0.7)); 
        transform: translateX(-50%) translateY(0px);
      }
      to { 
        filter: brightness(1.2) drop-shadow(0 0 35px rgba(0, 255, 204, 0.9)); 
        transform: translateX(-50%) translateY(-8px);
      }
    }

    .login-container {
      background: linear-gradient(135deg, 
        rgba(0, 0, 0, 0.9), 
        rgba(0, 195, 255, 0.15)
      );
      backdrop-filter: blur(25px);
      border: 2px solid rgba(0, 195, 255, 0.4);
      border-radius: 20px;
      padding: 28px 25px;
      width: 100%;
      max-width: 360px;
      box-shadow: 0 25px 60px rgba(0, 0, 0, 0.8);
      position: relative;
      transition: all 0.3s ease;
      z-index: 2;
      margin: 20px;
      margin-top: 58px;
    }

    .login-container:hover {
      border-color: rgba(0, 255, 204, 0.5);
      box-shadow: 0 30px 80px rgba(0, 195, 255, 0.4);
    }

    .language-menu {
      position: absolute;
      top: 15px;
      right: 15px;
      z-index: 10;
    }

    .language-menu button {
      background: linear-gradient(135deg, rgba(0, 195, 255, 0.2), rgba(0, 255, 204, 0.1));
      border: 2px solid rgba(0, 195, 255, 0.3);
      padding: 7px 11px;
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
      color: white;
      display: flex;
      align-items: center;
      gap: 7px;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      font-size: 0.85rem;
      min-width: 75px;
    }

    .language-menu button:hover {
      background: linear-gradient(135deg, rgba(0, 195, 255, 0.3), rgba(0, 255, 204, 0.2));
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 195, 255, 0.3);
    }

    .language-menu ul {
      display: none;
      position: absolute;
      top: 42px;
      right: 0;
      list-style: none;
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.9), rgba(0, 195, 255, 0.1));
      backdrop-filter: blur(15px);
      border: 2px solid rgba(0, 195, 255, 0.3);
      border-radius: 12px;
      padding: 8px 0;
      margin: 0;
      width: 110px;
      z-index: 99;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    .language-menu ul li {
      padding: 11px 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 9px;
      transition: all 0.3s ease;
      color: white;
      font-size: 0.85rem;
    }

    .language-menu ul li:hover {
      background: linear-gradient(90deg, rgba(0, 195, 255, 0.2), transparent);
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, #00c3ff, #00ffcc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 20px rgba(0, 195, 255, 0.5);
    }

    input {
      width: 100%;
      padding: 12px 16px;
      margin: 10px 0;
      border: 2px solid rgba(0, 195, 255, 0.4);
      border-radius: 12px;
      font-size: 13px;
      background: linear-gradient(135deg, 
        rgba(34, 34, 34, 0.9), 
        rgba(0, 195, 255, 0.1)
      );
      color: white;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    input::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    input:focus {
      outline: none;
      border-color: #00ffcc;
      background: linear-gradient(135deg, 
        rgba(0, 195, 255, 0.2), 
        rgba(0, 255, 204, 0.1)
      );
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0, 195, 255, 0.3);
    }

    button {
      width: 100%;
      padding: 13px 16px;
      margin: 14px 0 8px 0;
      border: none;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 700;
      cursor: pointer;
      background: linear-gradient(135deg, #00c3ff, #00ffcc);
      color: black;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: 0 10px 30px rgba(0, 195, 255, 0.4);
      position: relative;
      overflow: hidden;
    }

    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.6s ease;
    }

    button:hover::before {
      left: 100%;
    }

    button:hover {
      background: linear-gradient(135deg, #0099cc, #00cc99);
      transform: translateY(-2px);
      box-shadow: 0 15px 40px rgba(0, 195, 255, 0.6);
    }

    .form-switch {
      text-align: center;
      margin-top: 18px;
      font-size: 13px;
      color: rgba(255, 255, 255, 0.8);
    }

    .form-switch a {
      color: #00c3ff;
      text-decoration: none;
      cursor: pointer;
      display: inline-block;
      margin: 4px 7px;
      font-weight: bold;
      transition: all 0.3s ease;
      padding: 4px 9px;
      border-radius: 6px;
    }

    .form-switch a:hover {
      color: #00ffcc;
      background: rgba(0, 195, 255, 0.1);
      transform: translateY(-1px);
    }

    .hidden {
      display: none;
    }

    /* Checkbox para t√©rminos y condiciones */
    .terms-container {
      display: flex;
      align-items: flex-start;
      margin: 15px 0;
      font-size: 12px;
      color: rgba(255, 255, 255, 0.8);
      gap: 10px;
    }

    .terms-container input[type="checkbox"] {
      width: auto;
      margin: 0;
      padding: 0;
      transform: scale(1.2);
      accent-color: #00c3ff;
    }

    .terms-text {
      line-height: 1.4;
    }

    .terms-link {
      color: #00c3ff !important;
      text-decoration: underline;
      cursor: pointer;
      display: inline;
      margin: 0;
      padding: 0;
      background: none;
      border: none;
      border-radius: 0;
      transition: color 0.3s ease;
    }

    .terms-link:hover {
      color: #00ffcc !important;
      background: none;
      transform: none;
    }

    /* Modal para t√©rminos y condiciones */
    .modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
    }

    .modal-content {
      background: linear-gradient(135deg, 
        rgba(0, 0, 0, 0.95), 
        rgba(0, 195, 255, 0.1)
      );
      backdrop-filter: blur(20px);
      margin: 2% auto;
      padding: 0;
      border: 2px solid rgba(0, 195, 255, 0.4);
      border-radius: 20px;
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      overflow: hidden;
      box-shadow: 0 25px 60px rgba(0, 0, 0, 0.8);
      position: relative;
    }

    .modal-header {
      padding: 20px 30px;
      border-bottom: 2px solid rgba(0, 195, 255, 0.3);
      position: sticky;
      top: 0;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      z-index: 10;
    }

    .modal-header h2 {
      margin: 0;
      font-size: 1.5rem;
      background: linear-gradient(135deg, #00c3ff, #00ffcc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .modal-body {
      padding: 20px 30px;
      overflow-y: auto;
      max-height: calc(90vh - 140px);
      color: white;
    }

    .modal-body h3 {
      color: #00c3ff;
      font-size: 1.1rem;
      margin-top: 25px;
      margin-bottom: 10px;
      font-weight: bold;
    }

    .modal-body p, .modal-body ul {
      font-size: 0.9rem;
      line-height: 1.6;
      margin-bottom: 15px;
    }

    .modal-body ul {
      padding-left: 0;
      list-style: none;
    }

    .modal-body li {
      margin-bottom: 8px;
      padding-left: 20px;
      position: relative;
    }

    .modal-body li::before {
      content: "‚ö°";
      position: absolute;
      left: 0;
      color: #00c3ff;
    }

    .modal-footer {
      padding: 15px 30px;
      border-top: 2px solid rgba(0, 195, 255, 0.3);
      text-align: center;
      background: rgba(0, 0, 0, 0.9);
      position: sticky;
      bottom: 0;
    }

    .modal-close {
      background: linear-gradient(135deg, #00c3ff, #00ffcc);
      color: black;
      border: none;
      padding: 10px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .modal-close:hover {
      background: linear-gradient(135deg, #0099cc, #00cc99);
      transform: translateY(-2px);
    }

    .warning-box {
      background: linear-gradient(135deg, 
        rgba(255, 193, 7, 0.2), 
        rgba(255, 193, 7, 0.1)
      );
      border: 2px solid #ffc107;
      border-radius: 12px;
      padding: 15px;
      margin: 15px 0;
      font-size: 0.85rem;
    }

    .warning-box::before {
      content: "‚ö†Ô∏è ";
      font-size: 1rem;
    }

    /* Loading animation */
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }

    .loading button {
      background: linear-gradient(135deg, #666, #888);
      cursor: not-allowed;
    }

    /* Success/Error messages */
    .message {
      padding: 11px 15px;
      margin: 14px 0;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 600;
      text-align: center;
      opacity: 0;
      transform: translateY(-10px);
      transition: all 0.3s ease;
    }

    .message.show {
      opacity: 1;
      transform: translateY(0);
    }

    .message.success {
      background: linear-gradient(135deg, rgba(0, 255, 204, 0.2), rgba(0, 195, 255, 0.1));
      border: 2px solid rgba(0, 255, 204, 0.4);
      color: #00ffcc;
    }

    .message.error {
      background: linear-gradient(135deg, rgba(255, 100, 100, 0.2), rgba(255, 50, 50, 0.1));
      border: 2px solid rgba(255, 100, 100, 0.4);
      color: #ff6666;
    }

/* Logo ArbitraX inferior - CORREGIDO PARA M√ìVIL */
    .logo-container {
      position: fixed;
      bottom: 25px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 2.4rem;
      font-weight: 900;
      background: linear-gradient(135deg, #00c3ff, #00ffcc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 30px rgba(0, 195, 255, 0.5);
      animation: logoGlow 3s ease-in-out infinite alternate;
      letter-spacing: 1.5px;
      z-index: 1;
    }

    @keyframes logoGlow {
      from { 
        filter: brightness(1) drop-shadow(0 0 20px rgba(0, 195, 255, 0.7)); 
      }
      to { 
        filter: brightness(1.2) drop-shadow(0 0 35px rgba(0, 255, 204, 0.9)); 
      }
    }

    /* Responsive optimizado para 100% zoom en desktop */
    @media (max-width: 768px) {
      .floating-logo {
        font-size: 1.7rem;
        top: -45px;
      }

      .login-container {
        max-width: 340px;
        padding: 28px 24px;
        margin: 15px;
        margin-top: 55px;
      }

      .language-menu button {
        padding: 6px 8px;
        font-size: 0.75rem;
        min-width: 65px;
        gap: 5px;
      }

      .language-menu ul {
        width: 95px;
        top: 36px;
      }

      .language-menu ul li {
        padding: 9px 12px;
        font-size: 0.75rem;
        gap: 7px;
      }

      h2 {
        font-size: 1.45rem;
        margin-bottom: 20px;
      }

      input, button {
        padding: 12px 15px;
        font-size: 13px;
        margin: 10px 0;
      }

      .form-switch {
        font-size: 12px;
        margin-top: 15px;
      }

      .logo-container {
        font-size: 2.2rem;
        bottom: 25px;
      }
    }

    @media (max-width: 480px) {
      .floating-logo {
        font-size: 1.5rem;
        top: -38px;
        letter-spacing: 1px;
      }

      .login-container {
        max-width: 310px;
        padding: 24px 20px;
        margin: 12px;
        margin-top: 48px;
      }

      .language-menu button {
        padding: 5px 7px;
        font-size: 0.7rem;
        min-width: 58px;
        gap: 4px;
      }

      .language-menu ul {
        width: 80px;
        top: 33px;
      }

      .language-menu ul li {
        padding: 8px 10px;
        font-size: 0.7rem;
        gap: 5px;
      }

      h2 {
        font-size: 1.3rem;
        margin-bottom: 18px;
      }

      input, button {
        padding: 11px 14px;
        font-size: 13px;
        margin: 9px 0;
      }

      .form-switch {
        font-size: 11px;
        margin-top: 12px;
      }

      .form-switch a {
        margin: 3px 5px;
        padding: 3px 7px;
      }

      .logo-container {
        font-size: 1.8rem;
        bottom: 20px;
      }
    }

    /* Desktop optimizations - CORREGIDO PARA 100% ZOOM */
    @media (min-width: 1024px) {
      .floating-logo {
        font-size: 1.85rem;
        top: -50px;
      }

      .login-container {
        max-width: 370px;
        padding: 30px 28px;
        margin-top: 60px;
      }

      h2 {
        font-size: 1.6rem;
        margin-bottom: 22px;
      }

      input, button {
        padding: 13px 17px;
        font-size: 14px;
        margin: 12px 0;
      }

      .language-menu button {
        padding: 7px 11px;
        font-size: 0.8rem;
        min-width: 70px;
        gap: 6px;
      }

      .language-menu ul {
        width: 100px;
        top: 38px;
      }

      .language-menu ul li {
        padding: 10px 13px;
        font-size: 0.8rem;
        gap: 8px;
      }

      .form-switch {
        font-size: 12px;
        margin-top: 16px;
      }

      .logo-container {
        font-size: 2.8rem;
        bottom: 30px;
      }
    }

    /* Extra large screens */
    @media (min-width: 1440px) {
      .floating-logo {
        font-size: 2rem;
        top: -52px;
      }

      .login-container {
        max-width: 380px;
        padding: 32px 30px;
        margin-top: 65px;
      }

      h2 {
        font-size: 1.7rem;
        margin-bottom: 24px;
      }

      input, button {
        padding: 14px 18px;
        font-size: 14px;
        margin: 13px 0;
      }

      .logo-container {
        font-size: 3rem;
        bottom: 32px;
      }
    }
  </style>
</head>

<body>

<div class="login-container">
    <!-- Logo flotante ArbitraX -->
    <div class="floating-logo">ArbitraX</div>
    <!-- Men√∫ de idioma -->
    <div class="language-menu">
      <button onclick="toggleLangMenu()" id="currentLang">
        <img src="https://flagcdn.com/es.svg" width="20" /> ESP
      </button>
      <ul id="langOptions">
        <li onclick="setLang('es')"><img src="https://flagcdn.com/es.svg" width="20" /> ESP</li>
        <li onclick="setLang('en')"><img src="https://flagcdn.com/gb.svg" width="20" /> ENG</li>
        <li onclick="setLang('pt')"><img src="https://flagcdn.com/br.svg" width="20" /> POR</li>
      </ul>
    </div>

    <!-- Mensajes de estado -->
    <div id="messageContainer"></div>

    <!-- Login -->
    <div id="loginForm">
      <h2 id="loginTitle">
        <i class="fas fa-sign-in-alt"></i>
        Iniciar Sesi√≥n
      </h2>
      <input type="email" id="loginEmail" placeholder="Correo electr√≥nico" />
      <input type="password" id="loginPass" placeholder="Contrase√±a" />
      <button onclick="login()" id="loginBtn">
        <i class="fas fa-arrow-right"></i>
        Entrar
      </button>
      <div class="form-switch">
        <span id="noAccount">¬øNo tienes cuenta?</span>
        <a onclick="showForm('registerForm')" id="registerLink">
          <i class="fas fa-user-plus"></i>
          Registrarse
        </a><br>
        <a onclick="showForm('recoverForm')" id="forgotPass">
          <i class="fas fa-key"></i>
          ¬øOlvidaste tu contrase√±a?
        </a>
      </div>
    </div>

    <!-- Registro -->
    <div id="registerForm" class="hidden">
      <h2 id="registerTitle">
        <i class="fas fa-user-plus"></i>
        Registrarse
      </h2>
      <input type="email" id="regEmail" placeholder="Correo electr√≥nico" />
      <input type="password" id="regPass" placeholder="Contrase√±a" />
      <input type="password" id="regRepeat" placeholder="Repetir contrase√±a" />
      
      <div class="terms-container">
        <input type="checkbox" id="termsCheckbox" />
        <div class="terms-text">
          Acepto los <span class="terms-link" onclick="openTermsModal()">t√©rminos y condiciones</span>
        </div>
      </div>
      
      <button onclick="register()" id="createBtn">
        <i class="fas fa-check"></i>
        Crear cuenta
      </button>
      <div class="form-switch">
        <a onclick="showForm('loginForm')" id="backLogin">
          <i class="fas fa-arrow-left"></i>
          Volver al inicio
        </a>
      </div>
    </div>

<!-- Recuperar contrase√±a -->
    <div id="recoverForm" class="hidden">
      <h2 id="recoverTitle">
        <i class="fas fa-key"></i>
        Recuperar Contrase√±a
      </h2>
      <input type="email" id="recoveryEmail" placeholder="Correo electr√≥nico" />
      <button onclick="recoverPassword()" id="sendBtn">
        <i class="fas fa-paper-plane"></i>
        Enviar
      </button>
      <div class="form-switch">
        <a onclick="showForm('loginForm')" id="backLogin2">
          <i class="fas fa-arrow-left"></i>
          Volver al inicio
        </a>
      </div>
    </div>
  </div>

  <!-- Logo ArbitraX -->
  <div class="logo-container">ArbitraX</div>

  <!-- Modal de T√©rminos y Condiciones -->
  <div id="termsModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-file-contract"></i> T√©rminos y Condiciones</h2>
      </div>
      <div class="modal-body">
        <div class="warning-box">
          Al acceder, registrarte y utilizar esta plataforma, acept√°s sin restricciones los presentes t√©rminos y condiciones, los cuales regulan la participaci√≥n del usuario en los servicios ofrecidos: inversi√≥n en criptomonedas, miner√≠a digital, arbitraje automatizado, programas de referidos, sorteos y funcionalidades como Trivia, Mini Pool y Mystery Box.
        </div>

        <h3>üîß Uso de la plataforma</h3>
        <ul>
          <li>La plataforma act√∫a como intermediario digital que canaliza inversiones hacia actividades automatizadas vinculadas a criptoactivos.</li>
          <li>La participaci√≥n est√° sujeta a validaci√≥n de perfil y requisitos m√≠nimos para cada funci√≥n.</li>
          <li>Los usuarios deben mantener sus credenciales seguras. La empresa no se responsabiliza por accesos no autorizados por negligencia.</li>
        </ul>

        <h3>üìà Riesgos y rendimientos</h3>
        <ul>
          <li>Las inversiones est√°n sujetas a riesgo de mercado y no se garantiza retorno alguno.</li>
          <li>Los porcentajes anunciados son estimaciones hist√≥ricas, no contratos de rendimiento.</li>
          <li>El usuario acepta la posibilidad de p√©rdidas totales o parciales del capital invertido.</li>
        </ul>

        <h3>‚öñÔ∏è Limitaci√≥n de responsabilidad</h3>
        <ul>
          <li>No nos responsabilizamos por interrupciones, ataques inform√°ticos o cambios regulatorios.</li>
          <li>No brindamos asesoramiento financiero. Las decisiones del usuario son aut√≥nomas.</li>
          <li>La empresa no responde por resultados individuales ni expectativas personales.</li>
        </ul>

        <h3>üîÑ Modificaciones del servicio</h3>
        <ul>
          <li>La empresa puede modificar, suspender o eliminar funcionalidades sin previo aviso.</li>
          <li>Estos t√©rminos pueden ser actualizados en cualquier momento.</li>
          <li>El uso de m√∫ltiples cuentas, abuso de referidos o manipulaci√≥n de la plataforma est√° prohibido.</li>
        </ul>

        <h3>üéÅ Participaci√≥n en sorteos</h3>
        <ul>
          <li>Solo usuarios que cumplan con condiciones espec√≠ficas pueden participar.</li>
          <li>Los ganadores y premios se determinan exclusivamente por el administrador.</li>
          <li>Los premios est√°n sujetos a disponibilidad y rendimiento de la plataforma.</li>
        </ul>

        <h3>üß† Trivia</h3>
        <ul>
          <li>La secci√≥n de Trivia es de car√°cter l√∫dico y educativo, no representa una promesa de beneficio econ√≥mico.</li>
          <li>El sistema puede aplicar reglas de clasificaci√≥n autom√°tica seg√∫n respuestas y tiempo.</li>
          <li>La plataforma no se hace responsable por fallas t√©cnicas que afecten el desarrollo de la Trivia.</li>
        </ul>

        <h3>üèä‚Äç‚ôÇÔ∏è Mini Pool</h3>
        <ul>
          <li>El Mini Pool es una funcionalidad promocional con rendimiento variable.</li>
          <li>Est√° sujeta a cupos semanales y condiciones internas de liquidez.</li>
          <li>No garantiza pagos si la inversi√≥n no se encuentra validada o el usuario no cumple con requisitos.</li>
        </ul>

        <h3>üì¶ Mystery Box</h3>
        <ul>
          <li>Los premios son aleatorios y virtuales. La plataforma no garantiza premios monetarios.</li>
          <li>Los premios pueden incluir beneficios, puntos o accesos limitados dentro de la app.</li>
          <li>Una vez abierta la caja, no hay posibilidad de cambio, devoluci√≥n o reclamo.</li>
        </ul>

        <h3>üèõÔ∏è Jurisdicci√≥n</h3>
        <ul>
          <li>Este sistema no constituye una entidad financiera ni est√° regulado por entes oficiales.</li>
          <li>Los usuarios deben cumplir las normativas de su pa√≠s respecto a ingresos digitales o criptoactivos.</li>
        </ul>

        <h3>üìû Contacto y soporte</h3>
        <ul>
          <li>La atenci√≥n se realiza √∫nicamente mediante los canales oficiales mencionados dentro de la plataforma.</li>
          <li>La empresa no responder√° consultas enviadas por medios no autorizados.</li>
        </ul>

        <div class="warning-box">
          Al continuar usando esta plataforma, el usuario declara comprender y aceptar todos los puntos anteriores, liberando expresamente de responsabilidad a los desarrolladores, administradores, proveedores y aliados de cualquier da√±o directo o indirecto derivado del uso del sistema.
        </div>

        <p style="text-align: center; margin-top: 20px; font-size: 0.8rem; opacity: 0.8;">
          <i class="fas fa-calendar-alt"></i> √öltima actualizaci√≥n: junio 2025
        </p>
      </div>
      <div class="modal-footer">
        <button class="modal-close" onclick="closeTermsModal()">
          <i class="fas fa-times"></i> Cerrar
        </button>
      </div>
    </div>
  </div>

<script>
    const SUPABASE_URL = 'https://ovulezkcxwrjvyxlxsdv.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im92dWxlemtjeHdyanZ5eGx4c2R2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkwNzY5OTksImV4cCI6MjA2NDY1Mjk5OX0.ac82tkUR7AT0QVsuzuAGA8SXLkgnM9OX62meYNGnToI';
    const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Manejar par√°metros de referido
    const urlParams = new URLSearchParams(window.location.search);
    const ref = urlParams.get("ref");
    if (ref) localStorage.setItem("referido_por", ref);

    // FUNCI√ìN CR√çTICA: Detectar si es redirecci√≥n desde confirmaci√≥n de email
    function isEmailConfirmationRedirect() {
      // Verificar si hay par√°metros de confirmaci√≥n de email en la URL
      const hashParams = new URLSearchParams(window.location.hash.substring(1));
      const type = hashParams.get('type');
      
      // Si viene de confirmaci√≥n de email, limpiar URL y no hacer auto-login
      if (type === 'signup' || type === 'email_change') {
        // Limpiar la URL inmediatamente
        window.history.replaceState({}, document.title, window.location.pathname);
        return true;
      }
      return false;
    }

    // Funciones de UI
    function showForm(id) {
      ["loginForm", "registerForm", "recoverForm"].forEach(f => {
        document.getElementById(f).classList.add("hidden");
      });
      document.getElementById(id).classList.remove("hidden");
      hideMessage();
    }

    function showMessage(text, type = 'success') {
      const container = document.getElementById('messageContainer');
      container.innerHTML = `<div class="message ${type}">${text}</div>`;
      setTimeout(() => {
        container.querySelector('.message').classList.add('show');
      }, 100);
      
      // Auto-hide despu√©s de 5 segundos
      setTimeout(hideMessage, 5000);
    }

    function hideMessage() {
      const container = document.getElementById('messageContainer');
      const message = container.querySelector('.message');
      if (message) {
        message.classList.remove('show');
        setTimeout(() => container.innerHTML = '', 300);
      }
    }

    function setLoading(formId, loading) {
      const form = document.getElementById(formId);
      if (loading) {
        form.classList.add('loading');
      } else {
        form.classList.remove('loading');
      }
    }

    // Funciones del modal de t√©rminos y condiciones
    function openTermsModal() {
      document.getElementById('termsModal').style.display = 'block';
      document.body.style.overflow = 'hidden';
    }

    function closeTermsModal() {
      document.getElementById('termsModal').style.display = 'none';
      document.body.style.overflow = 'auto';
    }

    // Cerrar modal al hacer clic fuera de √©l
    window.onclick = function(event) {
      const modal = document.getElementById('termsModal');
      if (event.target == modal) {
        closeTermsModal();
      }
    }

    // Cerrar modal con tecla Escape
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        closeTermsModal();
      }
    });

    // FUNCI√ìN REGISTER CORREGIDA - CON VALIDACI√ìN DE T√âRMINOS Y URL CORRECTA
    async function register() {
      const email = document.getElementById("regEmail").value.trim();
      const pass1 = document.getElementById("regPass").value;
      const pass2 = document.getElementById("regRepeat").value;
      const termsAccepted = document.getElementById("termsCheckbox").checked;

      // Validaciones b√°sicas
      if (!email || !pass1 || !pass2) {
        showMessage("Completa todos los campos", 'error');
        return;
      }

      if (!termsAccepted) {
        showMessage("Debes aceptar los t√©rminos y condiciones", 'error');
        return;
      }

      if (pass1 !== pass2) {
        showMessage("Las contrase√±as no coinciden", 'error');
        return;
      }

      if (pass1.length < 6) {
        showMessage("La contrase√±a debe tener al menos 6 caracteres", 'error');
        return;
      }

      setLoading('registerForm', true);

      try {
        // Solo hacer signUp - el trigger se encarga del resto
        const { data, error } = await client.auth.signUp({ 
          email, 
          password: pass1,
          options: {
            emailRedirectTo: window.location.origin + '/reset.html'
          }
        });

        if (error) {
          throw new Error(error.message);
        }

        // Manejar referidos si existe
        const referidoPor = localStorage.getItem("referido_por");
        if (referidoPor && data?.user?.id) {
          try {
            await client.from("referidos").insert({
              usuario_id: data.user.id,
              referido_por: referidoPor,
              email: email,
              aprobado: false,
              fecha: new Date().toISOString()
            });
            localStorage.removeItem("referido_por");
          } catch (refError) {
            console.log("Error creando referido (no cr√≠tico):", refError);
          }
        }

        // √âxito - mostrar mensaje y cambiar a login
        showMessage("¬°Cuenta creada exitosamente! Revisa tu correo para verificarla.", 'success');
        
 // Limpiar campos
        document.getElementById("regEmail").value = '';
        document.getElementById("regPass").value = '';
        document.getElementById("regRepeat").value = '';
        document.getElementById("termsCheckbox").checked = false;
        
        // Cambiar a login despu√©s de un breve delay
        setTimeout(() => {
          showForm("loginForm");
        }, 2000);

      } catch (error) {
        console.error("Error en registro:", error);
        let errorMessage = "Error al crear la cuenta";
        
        if (error.message.includes("already registered")) {
          errorMessage = "Este correo ya est√° registrado";
        } else if (error.message.includes("Password")) {
          errorMessage = "La contrase√±a no cumple los requisitos";
        } else if (error.message.includes("Email")) {
          errorMessage = "Correo electr√≥nico inv√°lido";
        }
        
        showMessage(errorMessage, 'error');
      } finally {
        setLoading('registerForm', false);
      }
    }

    async function login() {
      const email = document.getElementById("loginEmail").value.trim();
      const pass = document.getElementById("loginPass").value;

      if (!email || !pass) {
        showMessage("Completa todos los campos", 'error');
        return;
      }

      setLoading('loginForm', true);

      try {
        const { error } = await client.auth.signInWithPassword({ 
          email, 
          password: pass 
        });
        
        if (error) {
          throw new Error(error.message);
        }

        // √âxito
        showMessage("¬°Bienvenido! Redirigiendo...", 'success');
        setTimeout(() => {
          window.location.href = "principal.html";
        }, 1500);

      } catch (error) {
        console.error("Error en login:", error);
        let errorMessage = "Error al iniciar sesi√≥n";
        
        if (error.message.includes("Invalid")) {
          errorMessage = "Correo o contrase√±a incorrectos";
        } else if (error.message.includes("Email not confirmed")) {
          errorMessage = "Confirma tu correo antes de iniciar sesi√≥n";
        }
        
        showMessage(errorMessage, 'error');
      } finally {
        setLoading('loginForm', false);
      }
    }

    async function recoverPassword() {
      const email = document.getElementById("recoveryEmail").value.trim();

      if (!email) {
        showMessage("Ingresa tu correo electr√≥nico", 'error');
        return;
      }

      setLoading('recoverForm', true);

      try {
        const { error } = await client.auth.resetPasswordForEmail(email, {
          redirectTo: window.location.origin + '/reset.html'
        });
        
        if (error) {
          throw new Error(error.message);
        }

        showMessage("Correo de recuperaci√≥n enviado. Revisa tu bandeja de entrada.", 'success');
        document.getElementById("recoveryEmail").value = '';
        
        setTimeout(() => {
          showForm("loginForm");
        }, 2000);

      } catch (error) {
        console.error("Error en recuperaci√≥n:", error);
        showMessage("Error al enviar el correo de recuperaci√≥n", 'error');
      } finally {
        setLoading('recoverForm', false);
      }
    }

    // Traducciones
    const translations = {
      es: {
        loginTitle: "Iniciar Sesi√≥n", registerTitle: "Registrarse", recoverTitle: "Recuperar Contrase√±a",
        loginBtn: "Entrar", createBtn: "Crear cuenta", sendBtn: "Enviar",
        noAccount: "¬øNo tienes cuenta?", registerLink: "Registrarse", forgotPass: "¬øOlvidaste tu contrase√±a?",
        backLogin: "Volver al inicio", backLogin2: "Volver al inicio"
      },
      en: {
        loginTitle: "Login", registerTitle: "Register", recoverTitle: "Reset Password",
        loginBtn: "Login", createBtn: "Create account", sendBtn: "Send",
        noAccount: "Don't have an account?", registerLink: "Register", forgotPass: "Forgot password?",
        backLogin: "Back to login", backLogin2: "Back to login"
      },
      pt: {
        loginTitle: "Entrar", registerTitle: "Registrar", recoverTitle: "Recuperar Senha",
        loginBtn: "Acessar", createBtn: "Criar conta", sendBtn: "Enviar",
        noAccount: "N√£o tem uma conta?", registerLink: "Registrar-se", forgotPass: "Esqueceu a senha?",
        backLogin: "Voltar", backLogin2: "Voltar"
      }
    };

    function toggleLangMenu() {
      const menu = document.getElementById("langOptions");
      menu.style.display = menu.style.display === "block" ? "none" : "block";
    }

    function setLang(lang) {
      const t = translations[lang];
      document.getElementById("loginTitle").innerHTML = `<i class="fas fa-sign-in-alt"></i> ${t.loginTitle}`;
      document.getElementById("registerTitle").innerHTML = `<i class="fas fa-user-plus"></i> ${t.registerTitle}`;
      document.getElementById("recoverTitle").innerHTML = `<i class="fas fa-key"></i> ${t.recoverTitle}`;
      document.getElementById("loginBtn").innerHTML = `<i class="fas fa-arrow-right"></i> ${t.loginBtn}`;
      document.getElementById("createBtn").innerHTML = `<i class="fas fa-check"></i> ${t.createBtn}`;
      document.getElementById("sendBtn").innerHTML = `<i class="fas fa-paper-plane"></i> ${t.sendBtn}`;
      document.getElementById("noAccount").innerText = t.noAccount;
      document.getElementById("registerLink").innerHTML = `<i class="fas fa-user-plus"></i> ${t.registerLink}`;
      document.getElementById("forgotPass").innerHTML = `<i class="fas fa-key"></i> ${t.forgotPass}`;
      document.getElementById("backLogin").innerHTML = `<i class="fas fa-arrow-left"></i> ${t.backLogin}`;
      document.getElementById("backLogin2").innerHTML = `<i class="fas fa-arrow-left"></i> ${t.backLogin2}`;

      const flags = { es: "es", en: "gb", pt: "br" };
      const names = { es: "ESP", en: "ENG", pt: "POR" };
      document.getElementById("currentLang").innerHTML =
        `<img src="https://flagcdn.com/${flags[lang]}.svg" width="20" /> ${names[lang]}`;
      document.getElementById("langOptions").style.display = "none";
    }

    // Cerrar men√∫ de idioma al hacer clic fuera
    document.addEventListener('click', function(event) {
      const langMenu = document.querySelector('.language-menu');
      const langOptions = document.getElementById('langOptions');
      
      if (!langMenu.contains(event.target)) {
        langOptions.style.display = 'none';
      }
    });

    // LISTENER MODIFICADO: Verificar si ya hay sesi√≥n activa pero IGNORAR confirmaciones de email
    client.auth.onAuthStateChange((event, session) => {
      // Si es una confirmaci√≥n de email, NO redirigir autom√°ticamente
      if (isEmailConfirmationRedirect()) {
        showMessage("Email confirmado exitosamente. Ya puedes iniciar sesi√≥n.", 'success');
        return;
      }

      // Solo redirigir si hay sesi√≥n Y no es confirmaci√≥n de email
      if (event === 'SIGNED_IN' && session && !isEmailConfirmationRedirect()) {
        window.location.href = 'principal.html';
      }
    });

    // Al cargar la p√°gina, verificar si es redirecci√≥n de confirmaci√≥n
    window.addEventListener('load', function() {
      if (isEmailConfirmationRedirect()) {
        showMessage("Email confirmado exitosamente. Ya puedes iniciar sesi√≥n.", 'success');
      }
    });
  </script>
</body>
</html>
